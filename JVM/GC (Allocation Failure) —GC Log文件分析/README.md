GC (Allocation Failure) —GC Log文件分析 





这是一段日志GC垃圾回收的日志，当我们加上`-Xloggc:/xxx/gc.log`后，JVM就会在执行垃圾回收时打印GC详情到指定文件，通常会配合`-XX:+PrintGCDetails -XX:+PrintGCDateStamps` 一起使用

![](http://image.easyblog.top/16772059216987eaa24b4-0f94-4fd1-a7a7-8fa2c8604cc1.png)



### GC日志分析

日志中这里截取了共有8个 GC(Allocation Failure) 日志（后续统一简称垃圾回收），接下来看下第一句日志：

> 2023-02-23T01:11:21.257+0000: 0.234: [GC (Allocation Failure) [PSYoungGen: 8704K->1008K(9728K)] 8704K->1730K(31744K), 0.0032204 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 



#### 2023-02-23T01:11:21.257+0000: 0.234: 

每一段的最前面，有两种格式的时间，分别是`绝对时间`和`JVM启动至今的秒数`。拎出来的这条日志打印时绝对时间就是`2023-02-23T01:11:21.257+0000` ，jvm 启动至今的秒数为 `0.234s`



#### GC/Full GC

`GC`和`Full GC`说明了这次垃圾收集的类型，`GC`表示发生了新生代GC（Minor GC），`Full GC`一般情况下表示同时发生了新生代GC（Minor GC）和老年代GC（Major GC）。`Allocation Failure`和`Ergonomics`表示触发GC的原因



#### PSYoungGen/PSOldGen/Metaspace

`PSYoungGen`、`ParOldGen`、`Metaspace`表示GC发生的区域，这里显示的区域名称与使用的垃圾收集器有关。



#### GC 内存变化信息

日志中`8704K->1008K(9728K)` 的含义是“GC前该内存区域已使用容量 -> GC后该内存区域已使用容量（该内存区域总容量）”。方括号之外的`8704K->1730K(31744K)`表示“GC前堆已使用容量 -> GC后堆已使用容量（堆总容量）”



#### GC 时间变化信息

`0.0032204 secs`表示该区域GC所花费的时间，单位是秒。

`[Times: user=0.00 sys=0.00, real=0.00 secs] `：

* user：代表cpu在用户态(目态)花费的时间，在垃圾回收的情况下，表示 GC 线程执行所使用的 CPU 总时间。
* sys：代表cpu花费在内核态(管态)的时间，即在内核执行系统调用或等待系统事件所使用的 CPU 时间。
* real：代表clock time，相当于我们现实世界走过的时间。

user + sys 是程序执行实际使用的 CPU 时间。一般在执行垃圾回收时是多线程并发执行GC，所以多数情况下real的值是小于user + sys的大小的，这里用户态耗时0.00s，内核态耗时0.00s，实际时间为0.00s。如果 real 偏大，则可能是因为磁盘IO负载过重或者是CPU资源不足所导致的，网络IO例如网络访问，磁盘读写等，CPU的话则是进程过多，GC任务没有获得过多的CPU时间或者单纯的任务重人手少，CPU数量不足。



#### 年轻代与Heap分析：

在一次垃圾回收中如何年轻代回收总量和总的堆回收总量两个值相等，说明年轻代减少的就是堆区减少的(咋感觉像是废话)，也说明此次垃圾回收过程中，没有对象从年轻代转入老年代，如果堆区减少的量小于年轻代减少的量，则代表有一部分对象从年轻代溜到了老年代。
