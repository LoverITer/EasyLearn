###  Apache Kafka —概述



### 1. 什么是消息系统

消息系统负责将数据从一个应用程序传输到另一个应用程序，因此应用程序可以专注于数据，但不担心如何共享它。 分布式消息传递基于可靠消息队列的概念。 消息在客户端应用程序和消息传递系统之间异步排队。 有两种类型的消息模式 ：一种是**点对点消息系统**，另一种是**发布 - 订阅(pub-sub)消息系统**。



####  1.1 点对点消息系统

在点对点消息系统中，消息生产者生产消息并发送到Queue中，然后消费者从Queue中取出并且消费消息。消息被消费以后，它就从队列中消失，所以消息消费者不可能消费到已经被消费的消息。Queue支持存在多个消费者，但是对一个消息而言，只会有一个消费者可以消费。该系统的典型示例是订单处理系统，其中每个订单将由一个订单处理器处理，但多个订单处理器也可以同时工作。 下图描述了该结构。

![img](https://image.easyblog.top/1228818-20180507190326476-771565746.png)

#### 1.2 发布/订阅模式

在发布 - 订阅系统中，消息生产者将消息发布到一个 topic（主题） 中，消费者可以订阅一个或多个主题并使用该主题中的所有消息，同时一个主题可以有多个消费者（订阅）。一个现实生活的例子是广播，它发布不同主题的广播，如运动，电影，音乐等，任何人都可以订阅自己的频道集，并获得他们订阅的频道时可用。下图描述了该结构。

![img](https://image.easyblog.top/1228818-20180507190443404-1266011458.png)





### 2. 什么是Kafka

**Kafka**最初是由Linkedin公司开发，是一个**分布式、分区的、多副本的、多订阅者，基于zookeeper协调的分布式日志系统**（也可以当做MQ系统），常见可以用于web/nginx日志、访问日志，消息服务等等，Linkedin于2010年贡献给了Apache基金会并成为顶级开源项目。

#### Kafka主要设计目标

- 以时间复杂度为O(1)的方式提供消息持久化能力，即使对TB级以上数据也能保证常数时间的访问性能。
- 高吞吐率。即使在非常廉价的商用机器上也能做到单机支持每秒100K条消息的传输。
- 支持Kafka Server间的消息分区，及分布式消费，同时保证每个partition内的消息顺序传输。
- 同时支持离线数据处理和实时数据处理。
- Scale out:支持在线水平扩展

#### Kafka的好处

以下是Kafka的几个好处 

- **可靠性** - Kafka是分布式，分区，复制和容错的。
- **可扩展性** - Kafka消息传递系统轻松缩放，无需停机。
- **耐用性** - Kafka使用分布式提交日志，这意味着消息会尽可能快地保留在磁盘上，因此它是持久的。
- **性能** - Kafka对于发布和订阅消息都具有高吞吐量。 即使存储了许多TB的消息，它也保持稳定的性能。

Kafka非常快，并保证零停机和零数据丢失。

#### Kafka使用场景

Kafka可以在许多用例中使用。 主要的使用场景是**超高吞吐量场景而数据精确度没那么高的系统**，**天然适合大数据实时计算和日志采集场景**，其中一些列出如下 

- **指标** - Kafka通常用于操作监控数据。 这涉及聚合来自分布式应用程序的统计信息，以产生操作数据的集中馈送。
- **日志聚合解决方案** - Kafka可用于跨组织从多个服务收集日志，并使它们以标准格式提供给多个服务器。
- **流处理** - 流行的框架(如Storm和Spark Streaming)从主题中读取数据，对其进行处理，并将处理后的数据写入新主题，供用户和应用程序使用。 Kafka的强耐久性在流处理的上下文中也非常有用。